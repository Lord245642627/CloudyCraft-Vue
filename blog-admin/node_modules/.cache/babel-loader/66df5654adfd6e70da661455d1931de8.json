{"ast":null,"code":"export default {\n  created() {\n    this.current = this.$store.state.pageState.user;\n    this.listUsers();\n    this.listRoles();\n  },\n\n  data: function () {\n    return {\n      loading: true,\n      isEdit: false,\n      userForm: {\n        userInfoId: null,\n        nickname: ''\n      },\n      loginType: null,\n      userRoles: [],\n      roleIds: [],\n      userList: [],\n      typeList: [{\n        type: 1,\n        desc: '邮箱'\n      }, {\n        type: 2,\n        desc: 'QQ'\n      }],\n      keywords: null,\n      current: 1,\n      size: 10,\n      count: 0\n    };\n  },\n  methods: {\n    searchUsers() {\n      this.current = 1;\n      this.listUsers();\n    },\n\n    sizeChange(size) {\n      this.size = size;\n      this.listUsers();\n    },\n\n    currentChange(current) {\n      this.current = current;\n      this.$store.commit('updateUserPageState', current);\n      this.listUsers();\n    },\n\n    changeDisable(user) {\n      this.axios.put('/api/admin/users/disable', {\n        id: user.userInfoId,\n        isDisable: user.isDisable\n      });\n    },\n\n    openEditModel(user) {\n      this.roleIds = [];\n      this.userForm = JSON.parse(JSON.stringify(user));\n      this.userForm.roles.forEach(item => {\n        this.roleIds.push(item.id);\n      });\n      this.isEdit = true;\n    },\n\n    editUserRole() {\n      this.userForm.roleIds = this.roleIds;\n      console.log(this.userForm);\n      this.axios.put('/api/admin/users/role', this.userForm).then(({\n        data\n      }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: data.message\n          });\n          this.listUsers();\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: data.message\n          });\n        }\n\n        this.isEdit = false;\n      });\n    },\n\n    listUsers() {\n      this.axios.get('/api/admin/users', {\n        params: {\n          current: this.current,\n          size: this.size,\n          keywords: this.keywords,\n          loginType: this.loginType\n        }\n      }).then(({\n        data\n      }) => {\n        this.userList = data.data.records;\n        this.count = data.data.count;\n        this.loading = false;\n      });\n    },\n\n    listRoles() {\n      this.axios.get('/api/admin/users/role').then(({\n        data\n      }) => {\n        this.userRoles = data.data;\n      });\n    }\n\n  },\n  watch: {\n    loginType() {\n      this.current = 1;\n      this.listUsers();\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAyGA;EACAA;IACA;IACA;IACA;EACA,CALA;;EAMAC;IACA;MACAC,aADA;MAEAC,aAFA;MAGAC;QACAC,gBADA;QAEAC;MAFA,CAHA;MAOAC,eAPA;MAQAC,aARA;MASAC,WATA;MAUAC,YAVA;MAWAC,WACA;QACAC,OADA;QAEAC;MAFA,CADA,EAKA;QACAD,OADA;QAEAC;MAFA,CALA,CAXA;MAqBAC,cArBA;MAsBAC,UAtBA;MAuBAC,QAvBA;MAwBAC;IAxBA;EA0BA,CAjCA;EAkCAC;IACAC;MACA;MACA;IACA,CAJA;;IAKAC;MACA;MACA;IACA,CARA;;IASAC;MACA;MACA;MACA;IACA,CAbA;;IAcAC;MACA;QACAC,mBADA;QAEAC;MAFA;IAIA,CAnBA;;IAoBAC;MACA;MACA;MACA;QACA;MACA,CAFA;MAGA;IACA,CA3BA;;IA4BAC;MACA;MACAC;MACA;QAAA1B;MAAA;QACA;UACA;YACA2B,WADA;YAEAC;UAFA;UAIA;QACA,CANA,MAMA;UACA;YACAD,WADA;YAEAC;UAFA;QAIA;;QACA;MACA,CAdA;IAeA,CA9CA;;IA+CAC;MACA,WACAC,GADA,CACA,kBADA,EACA;QACAC;UACAjB,qBADA;UAEAC,eAFA;UAGAF,uBAHA;UAIAP;QAJA;MADA,CADA,EASA0B,IATA,CASA;QAAAhC;MAAA;QACA;QACA;QACA;MACA,CAbA;IAcA,CA9DA;;IA+DAiC;MACA;QAAAjC;MAAA;QACA;MACA,CAFA;IAGA;;EAnEA,CAlCA;EAuGAkC;IACA5B;MACA;MACA;IACA;;EAJA;AAvGA","names":["created","data","loading","isEdit","userForm","userInfoId","nickname","loginType","userRoles","roleIds","userList","typeList","type","desc","keywords","current","size","count","methods","searchUsers","sizeChange","currentChange","changeDisable","id","isDisable","openEditModel","editUserRole","console","title","message","listUsers","get","params","then","listRoles","watch"],"sourceRoot":"src/views/user","sources":["User.vue"],"sourcesContent":["<template>\n  <el-card class=\"main-card\">\n    <div class=\"title\">{{ this.$route.name }}</div>\n    <div class=\"operation-container\">\n      <div style=\"margin-left: auto\">\n        <el-select clearable v-model=\"loginType\" placeholder=\"请选择登录方式\" size=\"small\" style=\"margin-right: 1rem\">\n          <el-option v-for=\"item in typeList\" :key=\"item.type\" :label=\"item.desc\" :value=\"item.type\" />\n        </el-select>\n        <el-input\n          v-model=\"keywords\"\n          prefix-icon=\"el-icon-search\"\n          size=\"small\"\n          placeholder=\"请输入昵称\"\n          style=\"width: 200px\"\n          @keyup.enter.native=\"searchUsers\" />\n        <el-button type=\"primary\" size=\"small\" icon=\"el-icon-search\" style=\"margin-left: 1rem\" @click=\"searchUsers\">\n          搜索\n        </el-button>\n      </div>\n    </div>\n    <el-table border :data=\"userList\" v-loading=\"loading\">\n      <el-table-column prop=\"linkAvatar\" label=\"头像\" align=\"center\" width=\"100\">\n        <template slot-scope=\"scope\">\n          <img :src=\"scope.row.avatar\" width=\"40\" height=\"40\" />\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"nickname\" label=\"昵称\" align=\"center\" width=\"140\" />\n      <el-table-column prop=\"loginType\" label=\"登录方式\" align=\"center\" width=\"80\">\n        <template slot-scope=\"scope\">\n          <el-tag type=\"success\" v-if=\"scope.row.loginType == 1\">邮箱</el-tag>\n          <el-tag v-if=\"scope.row.loginType == 2\">QQ</el-tag>\n          <el-tag type=\"danger\" v-if=\"scope.row.loginType == 3\">微博</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"roles\" label=\"用户角色\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <el-tag v-for=\"(item, index) of scope.row.roles\" :key=\"index\" style=\"margin-right: 4px; margin-top: 4px\">\n            {{ item.roleName }}\n          </el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"isDisable\" label=\"禁用\" align=\"center\" width=\"100\">\n        <template slot-scope=\"scope\">\n          <el-switch\n            v-model=\"scope.row.isDisable\"\n            active-color=\"#13ce66\"\n            inactive-color=\"#F4F4F5\"\n            :active-value=\"1\"\n            :inactive-value=\"0\"\n            @change=\"changeDisable(scope.row)\" />\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"ipAddress\" label=\"登录ip\" align=\"center\" width=\"140\" />\n      <el-table-column prop=\"ipSource\" label=\"登录地址\" align=\"center\" width=\"140\" />\n      <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"130\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <i class=\"el-icon-time\" style=\"margin-right: 5px\" />\n          {{ scope.row.createTime | date }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"lastLoginTime\" label=\"上次登录时间\" width=\"130\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <i class=\"el-icon-time\" style=\"margin-right: 5px\" />\n          {{ scope.row.lastLoginTime | date }}\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\" align=\"center\" width=\"100\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"primary\" size=\"mini\" @click=\"openEditModel(scope.row)\"> 编辑 </el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    <el-pagination\n      class=\"pagination-container\"\n      background\n      @size-change=\"sizeChange\"\n      @current-change=\"currentChange\"\n      :current-page=\"current\"\n      :page-size=\"size\"\n      :total=\"count\"\n      :page-sizes=\"[10, 20]\"\n      layout=\"total, sizes, prev, pager, next, jumper\" />\n    <el-dialog :visible.sync=\"isEdit\" width=\"30%\">\n      <div class=\"dialog-title-container\" slot=\"title\">修改用户</div>\n      <el-form label-width=\"60px\" size=\"medium\" :model=\"userForm\">\n        <el-form-item label=\"昵称\">\n          <el-input v-model=\"userForm.nickname\" style=\"width: 220px\" />\n        </el-form-item>\n        <el-form-item label=\"角色\">\n          <el-checkbox-group v-model=\"roleIds\">\n            <el-checkbox v-for=\"item of userRoles\" :key=\"item.id\" :label=\"item.id\">\n              {{ item.roleName }}\n            </el-checkbox>\n          </el-checkbox-group>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\">\n        <el-button @click=\"isEdit = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"editUserRole\"> 确 定 </el-button>\n      </div>\n    </el-dialog>\n  </el-card>\n</template>\n\n<script>\nexport default {\n  created() {\n    this.current = this.$store.state.pageState.user\n    this.listUsers()\n    this.listRoles()\n  },\n  data: function () {\n    return {\n      loading: true,\n      isEdit: false,\n      userForm: {\n        userInfoId: null,\n        nickname: ''\n      },\n      loginType: null,\n      userRoles: [],\n      roleIds: [],\n      userList: [],\n      typeList: [\n        {\n          type: 1,\n          desc: '邮箱'\n        },\n        {\n          type: 2,\n          desc: 'QQ'\n        }\n      ],\n      keywords: null,\n      current: 1,\n      size: 10,\n      count: 0\n    }\n  },\n  methods: {\n    searchUsers() {\n      this.current = 1\n      this.listUsers()\n    },\n    sizeChange(size) {\n      this.size = size\n      this.listUsers()\n    },\n    currentChange(current) {\n      this.current = current\n      this.$store.commit('updateUserPageState', current)\n      this.listUsers()\n    },\n    changeDisable(user) {\n      this.axios.put('/api/admin/users/disable', {\n        id: user.userInfoId,\n        isDisable: user.isDisable\n      })\n    },\n    openEditModel(user) {\n      this.roleIds = []\n      this.userForm = JSON.parse(JSON.stringify(user))\n      this.userForm.roles.forEach((item) => {\n        this.roleIds.push(item.id)\n      })\n      this.isEdit = true\n    },\n    editUserRole() {\n      this.userForm.roleIds = this.roleIds\n      console.log(this.userForm)\n      this.axios.put('/api/admin/users/role', this.userForm).then(({ data }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: data.message\n          })\n          this.listUsers()\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: data.message\n          })\n        }\n        this.isEdit = false\n      })\n    },\n    listUsers() {\n      this.axios\n        .get('/api/admin/users', {\n          params: {\n            current: this.current,\n            size: this.size,\n            keywords: this.keywords,\n            loginType: this.loginType\n          }\n        })\n        .then(({ data }) => {\n          this.userList = data.data.records\n          this.count = data.data.count\n          this.loading = false\n        })\n    },\n    listRoles() {\n      this.axios.get('/api/admin/users/role').then(({ data }) => {\n        this.userRoles = data.data\n      })\n    }\n  },\n  watch: {\n    loginType() {\n      this.current = 1\n      this.listUsers()\n    }\n  }\n}\n</script>\n"]},"metadata":{},"sourceType":"module"}