{"ast":null,"code":"export default {\n  created() {\n    this.current = this.$store.state.pageState.role;\n    this.listRoles();\n  },\n\n  data: function () {\n    return {\n      loading: true,\n      isDelete: false,\n      roles: [],\n      roleIds: [],\n      keywords: null,\n      current: 1,\n      size: 10,\n      total: 0,\n      roleMenu: false,\n      roleResource: false,\n      resources: [],\n      menus: [],\n      roleForm: {\n        roleName: '',\n        roleLabel: '',\n        resourceIds: [],\n        menuIds: []\n      }\n    };\n  },\n  methods: {\n    searchRoles() {\n      this.current = 1;\n      this.listRoles();\n    },\n\n    sizeChange(size) {\n      this.size = size;\n      this.listRoles();\n    },\n\n    currentChange(current) {\n      this.current = current;\n      this.$store.commit('updateRolePageState', current);\n      this.listRoles();\n    },\n\n    selectionChange(roles) {\n      this.roleIds = [];\n      roles.forEach(item => {\n        this.roleIds.push(item.id);\n      });\n    },\n\n    listRoles() {\n      this.axios.get('/api/admin/roles', {\n        params: {\n          current: this.current,\n          size: this.size,\n          keywords: this.keywords\n        }\n      }).then(({\n        data\n      }) => {\n        this.roles = data.data.records;\n        this.total = data.data.total;\n        this.loading = false;\n      });\n      this.axios.get('/api/admin/role/resources').then(({\n        data\n      }) => {\n        this.resources = data.data;\n      });\n      this.axios.get('/api/admin/role/menus').then(({\n        data\n      }) => {\n        this.menus = data.data;\n      });\n    },\n\n    deleteRoles(id) {\n      var param = {};\n\n      if (id == null) {\n        param = {\n          data: this.roleIds\n        };\n      } else {\n        param = {\n          data: [id]\n        };\n      }\n\n      this.axios.delete('/api/admin/roles', param).then(({\n        data\n      }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: data.message\n          });\n          this.listRoles();\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: data.message\n          });\n        }\n\n        this.isDelete = false;\n      });\n    },\n\n    openMenuModel(role) {\n      this.$nextTick(function () {\n        this.$refs.menuTree.setCheckedKeys([]);\n      });\n      this.$refs.roleTitle.innerHTML = role ? '修改角色' : '新增角色';\n\n      if (role != null) {\n        this.roleForm = JSON.parse(JSON.stringify(role));\n      } else {\n        this.roleForm = {\n          roleName: '',\n          roleLabel: '',\n          resourceIds: [],\n          menuIds: []\n        };\n      }\n\n      this.roleMenu = true;\n    },\n\n    openResourceModel(role) {\n      this.$nextTick(function () {\n        this.$refs.resourceTree.setCheckedKeys([]);\n      });\n      this.roleForm = JSON.parse(JSON.stringify(role));\n      this.roleResource = true;\n    },\n\n    saveOrUpdateRoleResource() {\n      this.roleForm.menuIds = null;\n      this.roleForm.resourceIds = this.$refs.resourceTree.getCheckedKeys();\n      this.axios.post('/api/admin/role', this.roleForm).then(({\n        data\n      }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: data.message\n          });\n          this.listRoles();\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: data.message\n          });\n        }\n\n        this.roleResource = false;\n      });\n    },\n\n    saveOrUpdateRoleMenu() {\n      if (this.roleForm.roleName.trim() == '') {\n        this.$message.error('角色名不能为空');\n        return false;\n      }\n\n      this.roleForm.resourceIds = null;\n      this.roleForm.menuIds = this.$refs.menuTree.getCheckedKeys().concat(this.$refs.menuTree.getHalfCheckedKeys());\n      this.axios.post('/api/admin/role', this.roleForm).then(({\n        data\n      }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: data.message\n          });\n          this.listRoles();\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: data.message\n          });\n        }\n\n        this.roleMenu = false;\n      });\n    }\n\n  }\n};","map":null,"metadata":{},"sourceType":"module"}