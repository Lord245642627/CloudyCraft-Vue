{"ast":null,"code":"export default {\n  created() {\n    this.current = this.$store.state.pageState.articleList;\n    this.listArticles();\n    this.listCategories();\n    this.listTags();\n  },\n\n  data: function () {\n    return {\n      uploadHeaders: {\n        Authorization: 'Bearer ' + sessionStorage.getItem('token')\n      },\n      loading: true,\n      updateIsDelete: false,\n      remove: false,\n      types: [{\n        value: 1,\n        label: '原创'\n      }, {\n        value: 2,\n        label: '转载'\n      }, {\n        value: 3,\n        label: '翻译'\n      }],\n      activeStatus: 'all',\n      articles: [],\n      articleIds: [],\n      categories: [],\n      tags: [],\n      keywords: null,\n      type: null,\n      categoryId: null,\n      tagId: null,\n      isDelete: 0,\n      isExport: false,\n      status: null,\n      current: 1,\n      size: 10,\n      total: 0\n    };\n  },\n  methods: {\n    selectionChange(articles) {\n      this.articleIds = [];\n      articles.forEach(item => {\n        this.articleIds.push(item.id);\n      });\n    },\n\n    searchArticles() {\n      this.current = 1;\n      this.listArticles();\n    },\n\n    editArticle(id) {\n      this.$router.push({\n        path: '/articles/' + id\n      });\n    },\n\n    updateArticleDelete(id) {\n      let param = {};\n\n      if (id != null) {\n        param.ids = [id];\n      } else {\n        param.ids = this.articleIds;\n      }\n\n      param.isDelete = this.isDelete == 0 ? 1 : 0;\n      this.axios.put('/api/admin/articles', param).then(({\n        data\n      }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: data.message\n          });\n          this.listArticles();\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: data.message\n          });\n        }\n\n        this.updateIsDelete = false;\n      });\n    },\n\n    deleteArticles(id) {\n      let param = {};\n\n      if (id == null) {\n        param = {\n          data: this.articleIds\n        };\n      } else {\n        param = {\n          data: [id]\n        };\n      }\n\n      this.axios.delete('/api/admin/articles/delete', param).then(({\n        data\n      }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: data.message\n          });\n          this.listArticles();\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: data.message\n          });\n        }\n\n        this.remove = false;\n      });\n    },\n\n    exportArticles(id) {\n      var param = {};\n\n      if (id == null) {\n        param = this.articleIds;\n      } else {\n        param = [id];\n      }\n\n      this.axios.post('/api/admin/articles/export', param).then(({\n        data\n      }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: data.message\n          });\n          data.data.forEach(item => {\n            this.downloadFile(item);\n          });\n          this.listArticles();\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: data.message\n          });\n        }\n\n        this.isExport = false;\n      });\n    },\n\n    downloadFile(url) {\n      const iframe = document.createElement('iframe');\n      iframe.style.display = 'none';\n      iframe.style.height = 0;\n      iframe.src = url;\n      document.body.appendChild(iframe);\n      setTimeout(() => {\n        iframe.remove();\n      }, 5 * 60 * 1000);\n    },\n\n    uploadArticle(data) {\n      if (data.code === 0) {\n        this.$notify.success({\n          title: '成功',\n          message: '导入成功'\n        });\n        this.listArticles();\n      } else {\n        this.$notify.error({\n          title: '失败',\n          message: data.message\n        });\n      }\n    },\n\n    sizeChange(size) {\n      this.size = size;\n      this.listArticles();\n    },\n\n    currentChange(current) {\n      this.current = current;\n      this.$store.commit('updateArticleListPageState', current);\n      this.listArticles();\n    },\n\n    changeStatus(status) {\n      switch (status) {\n        case 'all':\n          this.isDelete = 0;\n          this.status = null;\n          break;\n\n        case 'public':\n          this.isDelete = 0;\n          this.status = 1;\n          break;\n\n        case 'private':\n          this.isDelete = 0;\n          this.status = 2;\n          break;\n\n        case 'draft':\n          this.isDelete = 0;\n          this.status = 3;\n          break;\n\n        case 'delete':\n          this.isDelete = 1;\n          this.status = null;\n          break;\n      }\n\n      this.current = 1;\n      this.activeStatus = status;\n    },\n\n    changeTopAndFeatured(article) {\n      this.axios.put('/api/admin/articles/topAndFeatured', {\n        id: article.id,\n        isTop: article.isTop,\n        isFeatured: article.isFeatured\n      }).then(({\n        data\n      }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: '修改成功'\n          });\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: data.message\n          });\n        }\n\n        this.remove = false;\n      });\n    },\n\n    listArticles() {\n      this.axios.get('/api/admin/articles', {\n        params: {\n          current: this.current,\n          size: this.size,\n          keywords: this.keywords,\n          categoryId: this.categoryId,\n          status: this.status,\n          tagId: this.tagId,\n          type: this.type,\n          isDelete: this.isDelete\n        }\n      }).then(({\n        data\n      }) => {\n        this.articles = data.data.records;\n        this.total = data.data.total;\n        this.loading = false;\n      });\n    },\n\n    listCategories() {\n      this.axios.get('/api/admin/categories/search').then(({\n        data\n      }) => {\n        this.categories = data.data;\n      });\n    },\n\n    listTags() {\n      this.axios.get('/api/admin/tags/search').then(({\n        data\n      }) => {\n        this.tags = data.data;\n      });\n    }\n\n  },\n  watch: {\n    type() {\n      this.current = 1;\n      this.listArticles();\n    },\n\n    categoryId() {\n      this.current = 1;\n      this.listArticles();\n    },\n\n    tagId() {\n      this.current = 1;\n      this.listArticles();\n    },\n\n    status() {\n      this.current = 1;\n      this.listArticles();\n    },\n\n    isDelete() {\n      this.current = 1;\n      this.listArticles();\n    }\n\n  },\n  computed: {\n    articleType() {\n      return function (type) {\n        var tagType = '';\n        var name = '';\n\n        switch (type) {\n          case 1:\n            tagType = 'danger';\n            name = '原创';\n            break;\n\n          case 2:\n            tagType = 'success';\n            name = '转载';\n            break;\n\n          case 3:\n            tagType = 'primary';\n            name = '翻译';\n            break;\n        }\n\n        return {\n          tagType: tagType,\n          name: name\n        };\n      };\n    },\n\n    isActive() {\n      return function (status) {\n        return this.activeStatus == status ? 'active-status' : 'status';\n      };\n    }\n\n  }\n};","map":null,"metadata":{},"sourceType":"module"}