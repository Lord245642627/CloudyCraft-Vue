{"ast":null,"code":"export default {\n  created() {\n    if (this.$route.params.quartzId == 'all') {\n      this.jobId = 0;\n    } else if (this.$route.params.quartzId !== null) {\n      this.jobId = this.$route.params.quartzId;\n    }\n\n    if (this.jobId == this.$store.state.pageState.quartzLog.jobId) {\n      this.current = this.$store.state.pageState.quartzLog.current;\n    } else {\n      this.current = 1;\n      this.$store.commit('updateQuartzLogPageState', {\n        jobId: this.jobId,\n        current: this.current\n      });\n    }\n\n    this.listJobLogs();\n    this.listJobGroups();\n  },\n\n  data() {\n    return {\n      loading: true,\n      current: 1,\n      size: 10,\n      count: 0,\n      open: false,\n      jobId: 0,\n      jobLog: {},\n      searchParams: {},\n      jobGroups: [],\n      jobLogIds: [],\n      jobLogs: [],\n      dateRange: []\n    };\n  },\n\n  methods: {\n    selectionChange(jobLogs) {\n      this.jobLogIds = [];\n      jobLogs.forEach(item => {\n        this.jobLogIds.push(item.id);\n      });\n    },\n\n    listJobGroups() {\n      this.axios.get('/api/admin/jobLogs/jobGroups').then(({\n        data\n      }) => {\n        this.jobGroups = data.data;\n      });\n    },\n\n    listJobLogs() {\n      if (this.jobId === 0) {\n        this.searchParams.jobId = null;\n      } else {\n        this.searchParams.jobId = this.jobId;\n      }\n\n      this.searchParams.current = this.current;\n      this.searchParams.size = this.size;\n      this.searchParams.startTime = this.dateRange[0];\n      this.searchParams.endTime = this.dateRange[1];\n      this.axios.get('/api/admin/jobLogs', {\n        params: this.searchParams\n      }).then(({\n        data\n      }) => {\n        this.jobLogs = data.data.records;\n        this.count = data.data.count;\n        this.loading = false;\n      });\n    },\n\n    searchLogs() {\n      this.current = 1;\n      this.$store.commit('updateQuartzLogPageState', {\n        jobId: this.jobId,\n        current: this.current\n      });\n      this.listJobLogs();\n    },\n\n    clearSearch() {\n      this.searchParams = {};\n      this.dateRange = [];\n      this.listJobLogs();\n    },\n\n    sizeChange(size) {\n      this.size = size;\n      this.listJobLogs();\n    },\n\n    currentChange(current) {\n      this.current = current;\n      this.$store.commit('updateQuartzLogPageState', {\n        jobId: this.jobId,\n        current: this.current\n      });\n      this.listJobLogs();\n    },\n\n    deleteJobLogs() {\n      let param = {};\n      param = {\n        data: this.jobLogIds\n      };\n      this.axios.delete('/api/admin/jobLogs', param).then(({\n        data\n      }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: '删除成功'\n          });\n          this.listJobLogs();\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: '删除失败'\n          });\n        }\n      });\n    },\n\n    clean() {\n      this.axios.delete('/api/admin/jobLogs/clean').then(({\n        data\n      }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: '清空成功'\n          });\n          this.listJobLogs();\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: '清空失败'\n          });\n        }\n      });\n    },\n\n    changeOpen(jobLog) {\n      this.jobLog = jobLog;\n      this.jobLog.exceptionInfo = '\\n' + this.jobLog.exceptionInfo;\n      this.open = true;\n      this.$nextTick(() => {\n        Prism.highlightAll();\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":"AA4JA;EACAA;IACA;MACA;IACA,CAFA,MAEA;MACA;IACA;;IACA;MACA;IACA,CAFA,MAEA;MACA;MACA;QACAC,iBADA;QAEAC;MAFA;IAIA;;IACA;IACA;EACA,CAlBA;;EAmBAC;IACA;MACAC,aADA;MAEAF,UAFA;MAGAG,QAHA;MAIAC,QAJA;MAKAC,WALA;MAMAN,QANA;MAOAO,UAPA;MAQAC,gBARA;MASAC,aATA;MAUAC,aAVA;MAWAC,WAXA;MAYAC;IAZA;EAcA,CAlCA;;EAmCAC;IACAC;MACA;MACAH;QACA;MACA,CAFA;IAGA,CANA;;IAOAI;MACA;QAAAb;MAAA;QACA;MACA,CAFA;IAGA,CAXA;;IAYAc;MACA;QACA;MACA,CAFA,MAEA;QACA;MACA;;MACA;MACA;MACA;MACA;MACA,WACAC,GADA,CACA,oBADA,EACA;QACAC;MADA,CADA,EAIAC,IAJA,CAIA;QAAAjB;MAAA;QACA;QACA;QACA;MACA,CARA;IASA,CA/BA;;IAgCAkB;MACA;MACA;QACApB,iBADA;QAEAC;MAFA;MAIA;IACA,CAvCA;;IAwCAoB;MACA;MACA;MACA;IACA,CA5CA;;IA6CAC;MACA;MACA;IACA,CAhDA;;IAiDAC;MACA;MACA;QACAvB,iBADA;QAEAC;MAFA;MAIA;IACA,CAxDA;;IAyDAuB;MACA;MACAC;QAAAvB;MAAA;MACA;QAAAA;MAAA;QACA;UACA;YACAwB,WADA;YAEAC;UAFA;UAIA;QACA,CANA,MAMA;UACA;YACAD,WADA;YAEAC;UAFA;QAIA;MACA,CAbA;IAcA,CA1EA;;IA2EAC;MACA;QAAA1B;MAAA;QACA;UACA;YACAwB,WADA;YAEAC;UAFA;UAIA;QACA,CANA,MAMA;UACA;YACAD,WADA;YAEAC;UAFA;QAIA;MACA,CAbA;IAcA,CA1FA;;IA2FAE;MACA;MACA;MACA;MACA;QACAC;MACA,CAFA;IAGA;;EAlGA;AAnCA","names":["created","jobId","current","data","loading","size","count","open","jobLog","searchParams","jobGroups","jobLogIds","jobLogs","dateRange","methods","selectionChange","listJobGroups","listJobLogs","get","params","then","searchLogs","clearSearch","sizeChange","currentChange","deleteJobLogs","param","title","message","clean","changeOpen","Prism"],"sourceRoot":"src/views/log","sources":["QuartzLog.vue"],"sourcesContent":["<template>\n  <el-card class=\"main-card\">\n    <el-form :inline=\"true\" ref=\"form\" label-width=\"68px\">\n      <el-row>\n        <el-form-item label=\"任务名称\">\n          <el-input\n            style=\"width: 200px\"\n            size=\"small\"\n            v-model=\"searchParams.jobName\"\n            placeholder=\"请输入任务名称\"\n            @keyup.enter.native=\"listJobLogs\" />\n        </el-form-item>\n        <el-form-item label=\"任务组名\">\n          <el-select\n            size=\"small\"\n            @change=\"listJobLogs\"\n            clearable\n            style=\"margin-left: 5px\"\n            v-model=\"searchParams.jobGroup\"\n            placeholder=\"请选择组名\">\n            <el-option v-for=\"jobGroup in jobGroups\" :key=\"jobGroup\" :label=\"jobGroup\" :value=\"jobGroup\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"执行状态\">\n          <el-select\n            size=\"small\"\n            @change=\"listJobLogs\"\n            clearable\n            style=\"margin-left: 5px\"\n            v-model=\"searchParams.status\"\n            placeholder=\"请选择任务状态\">\n            <el-option value=\"1\" label=\"成功\" />\n            <el-option value=\"0\" label=\"失败\" />\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"执行时间\">\n          <el-date-picker\n            size=\"small\"\n            v-model=\"dateRange\"\n            type=\"daterange\"\n            range-separator=\"至\"\n            start-placeholder=\"开始日期\"\n            end-placeholder=\"结束日期\">\n          </el-date-picker>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" icon=\"el-icon-search\" size=\"small\" @click=\"searchLogs\">查找</el-button>\n          <el-button icon=\"el-icon-refresh\" size=\"small\" @click=\"clearSearch\">重置</el-button>\n        </el-form-item>\n      </el-row>\n    </el-form>\n    <el-row :gutter=\"10\" class=\"mb8\">\n      <el-col :span=\"1.5\">\n        <el-button :disabled=\"!jobLogIds.length\" type=\"danger\" icon=\"el-icon-delete\" size=\"small\" @click=\"deleteJobLogs\"\n          >批量删除\n        </el-button>\n      </el-col>\n      <el-col :span=\"1.5\">\n        <el-button type=\"danger\" icon=\"el-icon-delete\" size=\"small\" @click=\"clean\">清空</el-button>\n      </el-col>\n    </el-row>\n\n    <el-table\n      :default-sort=\"{ prop: 'createTime', order: 'descending' }\"\n      style=\"width: 100%\"\n      :data=\"jobLogs\"\n      v-loading=\"loading\"\n      @selection-change=\"selectionChange\">\n      <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\n      <el-table-column label=\"日志编号\" width=\"80\" align=\"center\" prop=\"id\">\n        <template slot-scope=\"scope\">\n          {{ scope.$index + 1 }}\n        </template>\n      </el-table-column>\n      <el-table-column label=\"任务名称\" align=\"center\" prop=\"jobName\" :show-overflow-tooltip=\"true\" />\n      <el-table-column label=\"任务组名\" align=\"center\" prop=\"jobGroup\" :show-overflow-tooltip=\"true\">\n        <template slot-scope=\"scope\">\n          <el-tag>\n            {{ scope.row.jobGroup }}\n          </el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"调用目标字符串\" align=\"center\" prop=\"invokeTarget\" :show-overflow-tooltip=\"true\" />\n      <el-table-column label=\"日志信息\" align=\"center\" prop=\"jobMessage\" :show-overflow-tooltip=\"true\" />\n      <el-table-column label=\"执行状态\" align=\"center\" prop=\"status\">\n        <template slot-scope=\"scope\">\n          <el-tag v-if=\"scope.row.status === 1\" type=\"success\">成功</el-tag>\n          <el-tag v-if=\"scope.row.status === 0\" type=\"danger\">失败</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"执行时间\" align=\"center\" prop=\"createTime\" width=\"180\">\n        <template slot-scope=\"scope\">\n          <span>{{ scope.row.startTime | dateTime }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\">\n        <template slot-scope=\"scope\">\n          <el-button size=\"mini\" type=\"text\" icon=\"el-icon-view\" @click=\"changeOpen(scope.row)\">详细</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    <el-pagination\n      class=\"pagination-container\"\n      background\n      @size-change=\"sizeChange\"\n      @current-change=\"currentChange\"\n      :current-page=\"current\"\n      :page-size=\"size\"\n      :total=\"count\"\n      :page-sizes=\"[10, 20]\"\n      layout=\"total, sizes, prev, pager, next, jumper\" />\n    <el-dialog\n      title=\"调度日志详细\"\n      :visible.sync=\"open\"\n      :width=\"jobLog.status == 1 ? '700px' : '80%'\"\n      append-to-body\n      destroy-on-close>\n      <el-form ref=\"form\" :model=\"jobLog\" label-width=\"100px\" size=\"mini\">\n        <el-row>\n          <el-col :span=\"12\">\n            <el-form-item label=\"日志序号：\">{{ jobLog.id }}</el-form-item>\n            <el-form-item label=\"任务名称：\">{{ jobLog.jobName }}</el-form-item>\n          </el-col>\n          <el-col :span=\"12\">\n            <el-form-item label=\"任务分组：\">{{ jobLog.jobGroup }}</el-form-item>\n            <el-form-item label=\"执行时间：\">{{ jobLog.startTime | dateTime }}</el-form-item>\n          </el-col>\n          <el-col :span=\"24\">\n            <el-form-item label=\"调用方法：\">{{ jobLog.invokeTarget }}</el-form-item>\n          </el-col>\n          <el-col :span=\"24\">\n            <el-form-item label=\"日志信息：\">{{ jobLog.jobMessage }}</el-form-item>\n          </el-col>\n          <el-col :span=\"24\">\n            <el-form-item label=\"执行状态：\">\n              <div v-if=\"jobLog.status === 1\">成功</div>\n              <div v-else-if=\"jobLog.status === 0\">失败</div>\n            </el-form-item>\n          </el-col>\n          <el-col v-if=\"jobLog.status == 0\" :span=\"24\">\n            <div>\n              <pre>\n\t\t<code class=\"language-java\">{{ jobLog.exceptionInfo }}</code>\n\t      </pre>\n            </div>\n          </el-col>\n        </el-row>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"open = false\">关闭</el-button>\n      </div>\n    </el-dialog>\n  </el-card>\n</template>\n\n<script>\nexport default {\n  created() {\n    if (this.$route.params.quartzId == 'all') {\n      this.jobId = 0\n    } else if (this.$route.params.quartzId !== null) {\n      this.jobId = this.$route.params.quartzId\n    }\n    if (this.jobId == this.$store.state.pageState.quartzLog.jobId) {\n      this.current = this.$store.state.pageState.quartzLog.current\n    } else {\n      this.current = 1\n      this.$store.commit('updateQuartzLogPageState', {\n        jobId: this.jobId,\n        current: this.current\n      })\n    }\n    this.listJobLogs()\n    this.listJobGroups()\n  },\n  data() {\n    return {\n      loading: true,\n      current: 1,\n      size: 10,\n      count: 0,\n      open: false,\n      jobId: 0,\n      jobLog: {},\n      searchParams: {},\n      jobGroups: [],\n      jobLogIds: [],\n      jobLogs: [],\n      dateRange: []\n    }\n  },\n  methods: {\n    selectionChange(jobLogs) {\n      this.jobLogIds = []\n      jobLogs.forEach((item) => {\n        this.jobLogIds.push(item.id)\n      })\n    },\n    listJobGroups() {\n      this.axios.get('/api/admin/jobLogs/jobGroups').then(({ data }) => {\n        this.jobGroups = data.data\n      })\n    },\n    listJobLogs() {\n      if (this.jobId === 0) {\n        this.searchParams.jobId = null\n      } else {\n        this.searchParams.jobId = this.jobId\n      }\n      this.searchParams.current = this.current\n      this.searchParams.size = this.size\n      this.searchParams.startTime = this.dateRange[0]\n      this.searchParams.endTime = this.dateRange[1]\n      this.axios\n        .get('/api/admin/jobLogs', {\n          params: this.searchParams\n        })\n        .then(({ data }) => {\n          this.jobLogs = data.data.records\n          this.count = data.data.count\n          this.loading = false\n        })\n    },\n    searchLogs() {\n      this.current = 1\n      this.$store.commit('updateQuartzLogPageState', {\n        jobId: this.jobId,\n        current: this.current\n      })\n      this.listJobLogs()\n    },\n    clearSearch() {\n      this.searchParams = {}\n      this.dateRange = []\n      this.listJobLogs()\n    },\n    sizeChange(size) {\n      this.size = size\n      this.listJobLogs()\n    },\n    currentChange(current) {\n      this.current = current\n      this.$store.commit('updateQuartzLogPageState', {\n        jobId: this.jobId,\n        current: this.current\n      })\n      this.listJobLogs()\n    },\n    deleteJobLogs() {\n      let param = {}\n      param = { data: this.jobLogIds }\n      this.axios.delete('/api/admin/jobLogs', param).then(({ data }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: '删除成功'\n          })\n          this.listJobLogs()\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: '删除失败'\n          })\n        }\n      })\n    },\n    clean() {\n      this.axios.delete('/api/admin/jobLogs/clean').then(({ data }) => {\n        if (data.code === 0) {\n          this.$notify.success({\n            title: '成功',\n            message: '清空成功'\n          })\n          this.listJobLogs()\n        } else {\n          this.$notify.error({\n            title: '失败',\n            message: '清空失败'\n          })\n        }\n      })\n    },\n    changeOpen(jobLog) {\n      this.jobLog = jobLog\n      this.jobLog.exceptionInfo = '\\n' + this.jobLog.exceptionInfo\n      this.open = true\n      this.$nextTick(() => {\n        Prism.highlightAll()\n      })\n    }\n  }\n}\n</script>\n\n<style scoped></style>\n"]},"metadata":{},"sourceType":"module"}