{"ast":null,"code":"import * as imageConversion from 'image-conversion';\nimport Editor from '@/components/Editor.vue';\nexport default {\n  components: {\n    Editor\n  },\n\n  created() {\n    if (this.$route.params.talkId) {\n      this.axios.get('/api/admin/talks/' + this.$route.params.talkId).then(({\n        data\n      }) => {\n        this.talk = data.data;\n\n        if (data.data.imgs) {\n          data.data.imgs.forEach(item => {\n            this.uploads.push({\n              url: item\n            });\n          });\n        }\n      });\n    }\n  },\n\n  data: function () {\n    return {\n      talk: {\n        id: null,\n        content: '',\n        isTop: 0,\n        isSecret: 1,\n        images: ''\n      },\n      status: [{\n        isSecret: 1,\n        desc: '公开'\n      }, {\n        isSecret: 2,\n        desc: '私密'\n      }],\n      uploads: [],\n      headers: {\n        Authorization: 'Bearer ' + sessionStorage.getItem('token')\n      }\n    };\n  },\n  methods: {\n    handleCommand(command) {\n      this.talk.isSecret = command;\n    },\n\n    handleRemove(file) {\n      this.uploads.forEach((item, index) => {\n        if (item.url == file.url) {\n          this.uploads.splice(index, 1);\n        }\n      });\n    },\n\n    upload(response) {\n      this.uploads.push({\n        url: response.data\n      });\n    },\n\n    beforeUpload(file) {\n      return new Promise(resolve => {\n        if (file.size / 1024 < this.config.UPLOAD_SIZE) {\n          resolve(file);\n        }\n\n        imageConversion.compressAccurately(file, this.config.UPLOAD_SIZE).then(res => {\n          resolve(res);\n        });\n      });\n    },\n\n    saveOrUpdateTalk() {\n      if (this.talk.content.trim() == '') {\n        this.$message.error('说说内容不能为空');\n        return false;\n      }\n\n      if (this.uploads.length > 0) {\n        var img = [];\n        this.uploads.forEach(item => {\n          img.push(item.url);\n        });\n        this.talk.images = JSON.stringify(img);\n      } else {\n        this.talk.images = '';\n      }\n\n      this.axios.post('/api/admin/talks', this.talk).then(({\n        data\n      }) => {\n        if (data.code === 0) {\n          this.$refs.editor.clear();\n          this.uploads = [];\n          this.$router.push({\n            path: '/talk-list'\n          });\n          this.$notify.success({\n            title: '成功',\n            message: data.message\n          });\n        } else {\n          this.$notify.error({\n            title: '失败',\n            // message: data.message\n            message: data.code\n          });\n        }\n      });\n    }\n\n  },\n  computed: {\n    dropdownTitle() {\n      var desc = '';\n      this.status.forEach(item => {\n        if (item.isSecret == this.talk.isSecret) {\n          desc = item.desc;\n        }\n      });\n      return desc;\n    }\n\n  }\n};","map":null,"metadata":{},"sourceType":"module"}