{"ast":null,"code":"/*!\n  * @intlify/runtime v9.1.10\n  * (c) 2022 kazuya kawaguchi\n  * Released under the MIT License.\n  */\nimport { isNumber, isObject, isString, isFunction, isPlainObject, toDisplayString } from '@intlify/shared';\n\nconst DEFAULT_MODIFIER = str => str;\n\nconst DEFAULT_MESSAGE = ctx => ''; // eslint-disable-line\n\n\nconst DEFAULT_MESSAGE_DATA_TYPE = 'text';\n\nconst DEFAULT_NORMALIZE = values => values.length === 0 ? '' : values.join('');\n\nconst DEFAULT_INTERPOLATE = toDisplayString;\n\nfunction pluralDefault(choice, choicesLength) {\n  choice = Math.abs(choice);\n\n  if (choicesLength === 2) {\n    // prettier-ignore\n    return choice ? choice > 1 ? 1 : 0 : 1;\n  }\n\n  return choice ? Math.min(choice, 2) : 0;\n}\n\nfunction getPluralIndex(options) {\n  // prettier-ignore\n  const index = isNumber(options.pluralIndex) ? options.pluralIndex : -1; // prettier-ignore\n\n  return options.named && (isNumber(options.named.count) || isNumber(options.named.n)) ? isNumber(options.named.count) ? options.named.count : isNumber(options.named.n) ? options.named.n : index : index;\n}\n\nfunction normalizeNamed(pluralIndex, props) {\n  if (!props.count) {\n    props.count = pluralIndex;\n  }\n\n  if (!props.n) {\n    props.n = pluralIndex;\n  }\n}\n\nfunction createMessageContext(options = {}) {\n  const locale = options.locale;\n  const pluralIndex = getPluralIndex(options);\n  const pluralRule = isObject(options.pluralRules) && isString(locale) && isFunction(options.pluralRules[locale]) ? options.pluralRules[locale] : pluralDefault;\n  const orgPluralRule = isObject(options.pluralRules) && isString(locale) && isFunction(options.pluralRules[locale]) ? pluralDefault : undefined;\n\n  const plural = messages => messages[pluralRule(pluralIndex, messages.length, orgPluralRule)];\n\n  const _list = options.list || [];\n\n  const list = index => _list[index]; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  const _named = options.named || {};\n\n  isNumber(options.pluralIndex) && normalizeNamed(pluralIndex, _named);\n\n  const named = key => _named[key]; // TODO: need to design resolve message function?\n\n\n  function message(key) {\n    // prettier-ignore\n    const msg = isFunction(options.messages) ? options.messages(key) : isObject(options.messages) ? options.messages[key] : false;\n    return !msg ? options.parent ? options.parent.message(key) // resolve from parent messages\n    : DEFAULT_MESSAGE : msg;\n  }\n\n  const _modifier = name => options.modifiers ? options.modifiers[name] : DEFAULT_MODIFIER;\n\n  const normalize = isPlainObject(options.processor) && isFunction(options.processor.normalize) ? options.processor.normalize : DEFAULT_NORMALIZE;\n  const interpolate = isPlainObject(options.processor) && isFunction(options.processor.interpolate) ? options.processor.interpolate : DEFAULT_INTERPOLATE;\n  const type = isPlainObject(options.processor) && isString(options.processor.type) ? options.processor.type : DEFAULT_MESSAGE_DATA_TYPE;\n  const ctx = {\n    [\"list\"\n    /* LIST */\n    ]: list,\n    [\"named\"\n    /* NAMED */\n    ]: named,\n    [\"plural\"\n    /* PLURAL */\n    ]: plural,\n    [\"linked\"\n    /* LINKED */\n    ]: (key, modifier) => {\n      // TODO: should check `key`\n      const msg = message(key)(ctx);\n      return isString(modifier) ? _modifier(modifier)(msg) : msg;\n    },\n    [\"message\"\n    /* MESSAGE */\n    ]: message,\n    [\"type\"\n    /* TYPE */\n    ]: type,\n    [\"interpolate\"\n    /* INTERPOLATE */\n    ]: interpolate,\n    [\"normalize\"\n    /* NORMALIZE */\n    ]: normalize\n  };\n  return ctx;\n}\n\nexport { DEFAULT_MESSAGE_DATA_TYPE, createMessageContext };","map":null,"metadata":{},"sourceType":"module"}