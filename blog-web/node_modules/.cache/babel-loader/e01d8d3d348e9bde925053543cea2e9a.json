{"ast":null,"code":"import { ref, reactive, h, Transition, withCtx, withDirectives, createVNode, vShow, createApp, toRefs } from 'vue';\nimport '../../../hooks/index.mjs';\nimport '../../../utils/index.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { removeClass } from '../../../utils/dom/style.mjs';\n\nfunction createLoadingComponent(options) {\n  let afterLeaveTimer;\n  const ns = useNamespace(\"loading\");\n  const afterLeaveFlag = ref(false);\n  const data = reactive({ ...options,\n    originalPosition: \"\",\n    originalOverflow: \"\",\n    visible: false\n  });\n\n  function setText(text) {\n    data.text = text;\n  }\n\n  function destroySelf() {\n    const target = data.parent;\n\n    if (!target.vLoadingAddClassList) {\n      let loadingNumber = target.getAttribute(\"loading-number\");\n      loadingNumber = Number.parseInt(loadingNumber) - 1;\n\n      if (!loadingNumber) {\n        removeClass(target, ns.bm(\"parent\", \"relative\"));\n        target.removeAttribute(\"loading-number\");\n      } else {\n        target.setAttribute(\"loading-number\", loadingNumber.toString());\n      }\n\n      removeClass(target, ns.bm(\"parent\", \"hidden\"));\n    }\n\n    removeElLoadingChild();\n    loadingInstance.unmount();\n  }\n\n  function removeElLoadingChild() {\n    var _a, _b;\n\n    (_b = (_a = vm.$el) == null ? void 0 : _a.parentNode) == null ? void 0 : _b.removeChild(vm.$el);\n  }\n\n  function close() {\n    var _a;\n\n    if (options.beforeClose && !options.beforeClose()) return;\n    const target = data.parent;\n    target.vLoadingAddClassList = void 0;\n    afterLeaveFlag.value = true;\n    clearTimeout(afterLeaveTimer);\n    afterLeaveTimer = window.setTimeout(() => {\n      if (afterLeaveFlag.value) {\n        afterLeaveFlag.value = false;\n        destroySelf();\n      }\n    }, 400);\n    data.visible = false;\n    (_a = options.closed) == null ? void 0 : _a.call(options);\n  }\n\n  function handleAfterLeave() {\n    if (!afterLeaveFlag.value) return;\n    afterLeaveFlag.value = false;\n    destroySelf();\n  }\n\n  const elLoadingComponent = {\n    name: \"ElLoading\",\n\n    setup() {\n      return () => {\n        const svg = data.spinner || data.svg;\n        const spinner = h(\"svg\", {\n          class: \"circular\",\n          viewBox: data.svgViewBox ? data.svgViewBox : \"25 25 50 50\",\n          ...(svg ? {\n            innerHTML: svg\n          } : {})\n        }, [h(\"circle\", {\n          class: \"path\",\n          cx: \"50\",\n          cy: \"50\",\n          r: \"20\",\n          fill: \"none\"\n        })]);\n        const spinnerText = data.text ? h(\"p\", {\n          class: ns.b(\"text\")\n        }, [data.text]) : void 0;\n        return h(Transition, {\n          name: ns.b(\"fade\"),\n          onAfterLeave: handleAfterLeave\n        }, {\n          default: withCtx(() => [withDirectives(createVNode(\"div\", {\n            style: {\n              backgroundColor: data.background || \"\"\n            },\n            class: [ns.b(\"mask\"), data.customClass, data.fullscreen ? \"is-fullscreen\" : \"\"]\n          }, [h(\"div\", {\n            class: ns.b(\"spinner\")\n          }, [spinner, spinnerText])]), [[vShow, data.visible]])])\n        });\n      };\n    }\n\n  };\n  const loadingInstance = createApp(elLoadingComponent);\n  const vm = loadingInstance.mount(document.createElement(\"div\"));\n  return { ...toRefs(data),\n    setText,\n    removeElLoadingChild,\n    close,\n    handleAfterLeave,\n    vm,\n\n    get $el() {\n      return vm.$el;\n    }\n\n  };\n}\n\nexport { createLoadingComponent };","map":null,"metadata":{},"sourceType":"module"}