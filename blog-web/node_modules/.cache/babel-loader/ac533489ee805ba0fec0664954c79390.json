{"ast":null,"code":"// Parse link destination\n//\n'use strict';\n\nvar unescapeAll = require('../common/utils').unescapeAll;\n\nmodule.exports = function parseLinkDestination(str, pos, max) {\n  var code,\n      level,\n      lines = 0,\n      start = pos,\n      result = {\n    ok: false,\n    pos: 0,\n    lines: 0,\n    str: ''\n  };\n\n  if (str.charCodeAt(pos) === 0x3C\n  /* < */\n  ) {\n    pos++;\n\n    while (pos < max) {\n      code = str.charCodeAt(pos);\n\n      if (code === 0x0A\n      /* \\n */\n      ) {\n        return result;\n      }\n\n      if (code === 0x3C\n      /* < */\n      ) {\n        return result;\n      }\n\n      if (code === 0x3E\n      /* > */\n      ) {\n        result.pos = pos + 1;\n        result.str = unescapeAll(str.slice(start + 1, pos));\n        result.ok = true;\n        return result;\n      }\n\n      if (code === 0x5C\n      /* \\ */\n      && pos + 1 < max) {\n        pos += 2;\n        continue;\n      }\n\n      pos++;\n    } // no closing '>'\n\n\n    return result;\n  } // this should be ... } else { ... branch\n\n\n  level = 0;\n\n  while (pos < max) {\n    code = str.charCodeAt(pos);\n\n    if (code === 0x20) {\n      break;\n    } // ascii control characters\n\n\n    if (code < 0x20 || code === 0x7F) {\n      break;\n    }\n\n    if (code === 0x5C\n    /* \\ */\n    && pos + 1 < max) {\n      if (str.charCodeAt(pos + 1) === 0x20) {\n        break;\n      }\n\n      pos += 2;\n      continue;\n    }\n\n    if (code === 0x28\n    /* ( */\n    ) {\n      level++;\n\n      if (level > 32) {\n        return result;\n      }\n    }\n\n    if (code === 0x29\n    /* ) */\n    ) {\n      if (level === 0) {\n        break;\n      }\n\n      level--;\n    }\n\n    pos++;\n  }\n\n  if (start === pos) {\n    return result;\n  }\n\n  if (level !== 0) {\n    return result;\n  }\n\n  result.str = unescapeAll(str.slice(start, pos));\n  result.lines = lines;\n  result.pos = pos;\n  result.ok = true;\n  return result;\n};","map":null,"metadata":{},"sourceType":"script"}