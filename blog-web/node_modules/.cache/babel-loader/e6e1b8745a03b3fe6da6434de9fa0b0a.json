{"ast":null,"code":"import { throttle } from \"./uitls\";\nconst ctx = \"vue3@InfiniteScroll\";\n\nconst getScrollTop = function (element) {\n  if (element === window) {\n    return Math.max(window.pageYOffset || 0, document.documentElement.scrollTop);\n  }\n\n  return element.scrollTop;\n};\n\nconst getComputedStyle = document.defaultView.getComputedStyle;\n\nconst getScrollEventTarget = function (element) {\n  let currentNode = element;\n\n  while (currentNode && currentNode.tagName !== \"HTML\" && currentNode.tagName !== \"BODY\" && currentNode.nodeType === 1) {\n    const overflowY = getComputedStyle(currentNode).overflowY;\n\n    if (overflowY === \"scroll\" || overflowY === \"auto\") {\n      return currentNode;\n    }\n\n    currentNode = currentNode.parentNode;\n  }\n\n  return window;\n};\n\nconst getVisibleHeight = function (element) {\n  if (element === window) {\n    return document.documentElement.clientHeight;\n  }\n\n  return element.clientHeight;\n};\n\nconst getElementTop = function (element) {\n  if (element === window) {\n    return getScrollTop(window);\n  }\n\n  return element.getBoundingClientRect().top + getScrollTop(window);\n};\n\nconst isAttached = function (element) {\n  let currentNode = element.parentNode;\n\n  while (currentNode) {\n    if (currentNode.tagName === \"HTML\") {\n      return true;\n    }\n\n    if (currentNode.nodeType === 11) {\n      return false;\n    }\n\n    currentNode = currentNode.parentNode;\n  }\n\n  return false;\n};\n\nconst doBind = function doBind(context) {\n  if (context.binded) return;\n  context.binded = true;\n  const self = context;\n  const element = self.el;\n  const throttleDelayExpr = element.getAttribute(\"infinite-scroll-throttle-delay\");\n  let throttleDelay = 200;\n\n  if (throttleDelayExpr !== null && throttleDelayExpr !== undefined) {\n    throttleDelay = Number(throttleDelayExpr);\n\n    if (isNaN(throttleDelay) || throttleDelay < 0) {\n      throttleDelay = 200;\n    }\n  }\n\n  self.throttleDelay = throttleDelay;\n  self.scrollEventTarget = getScrollEventTarget(element);\n  self.scrollListener = throttle(doCheck, self.throttleDelay, self);\n  self.scrollEventTarget.addEventListener(\"scroll\", self.scrollListener); // disabled的值\n\n  const disabledExpr = element.getAttribute(\"infinite-scroll-disabled\");\n  let disabled = false; // 要监听的值\n\n  const watchDisabledExpr = element.getAttribute(\"infinite-scroll-watch-disabled\");\n\n  if (disabledExpr !== null && disabledExpr !== undefined) {\n    // 监听disabled值，如果为true则紧张滚动事件触发\n    context.vm.$watch(watchDisabledExpr, function (value) {\n      self.disabled = value;\n\n      if (!value && self.immediateCheck) {\n        doCheck(self);\n      }\n    });\n    disabled = disabledExpr === 'true';\n  }\n\n  self.disabled = disabled;\n  const distanceExpr = element.getAttribute(\"infinite-scroll-distance\");\n  let distance = 0;\n\n  if (distanceExpr !== null && distanceExpr !== undefined) {\n    distance = Number(distanceExpr);\n\n    if (isNaN(distance)) {\n      distance = 0;\n    }\n  }\n\n  self.distance = distance; // 检查是否立即执行\n\n  const immediateCheckExpr = element.getAttribute(\"infinite-scroll-immediate-check\");\n  let immediateCheck = true;\n\n  if (immediateCheckExpr !== null && immediateCheckExpr !== undefined) {\n    immediateCheck = Boolean(immediateCheckExpr);\n  }\n\n  self.immediateCheck = immediateCheck;\n\n  if (immediateCheck) {\n    doCheck(self);\n  }\n};\n\nconst doCheck = function doCheck(context, force) {\n  const scrollEventTarget = context.scrollEventTarget;\n  const element = context.el;\n  const distance = context.distance;\n  if (force !== true && context.disabled) return;\n  const viewportScrollTop = getScrollTop(scrollEventTarget);\n  const viewportBottom = viewportScrollTop + getVisibleHeight(scrollEventTarget);\n  let shouldTrigger = false;\n\n  if (scrollEventTarget === element) {\n    shouldTrigger = scrollEventTarget.scrollHeight - viewportBottom <= distance;\n  } else {\n    const elementBottom = getElementTop(element) - getElementTop(scrollEventTarget) + element.offsetHeight + viewportScrollTop;\n    shouldTrigger = viewportBottom + distance >= elementBottom;\n  } // context.expression 为绑定的v-infinite-scroll\n\n\n  if (shouldTrigger && context.expression) {\n    context.expression();\n  }\n};\n\nconst InfiniteScroll = {\n  created: function bind(el, binding, vnode) {\n    el[ctx] = {\n      el: el,\n      vm: binding.instance,\n      expression: binding.value\n    };\n    el[ctx].vm.$nextTick(function () {\n      if (isAttached(el)) {\n        doBind(el[ctx]);\n      }\n\n      el[ctx].bindTryCount = 0;\n\n      const tryBind = function tryBind() {\n        if (el[ctx].bindTryCount > 10) return;\n        el[ctx].bindTryCount++;\n\n        if (isAttached(el)) {\n          doBind(el[ctx]);\n        } else {\n          setTimeout(tryBind, 50);\n        }\n      };\n\n      tryBind();\n    }); // });\n  },\n  unmounted: function unbind(el) {\n    if (el && el[ctx] && el[ctx].scrollEventTarget) el[ctx].scrollEventTarget.removeEventListener(\"scroll\", el[ctx].scrollListener);\n  }\n};\n\nconst install = function install(Vue) {\n  Vue.directive(\"InfiniteScroll\", InfiniteScroll);\n};\n\nInfiniteScroll.install = install;\nexport default InfiniteScroll;","map":{"version":3,"mappings":"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","names":["throttle","ctx","getScrollTop","element","window","Math","max","pageYOffset","document","documentElement","scrollTop","getComputedStyle","defaultView","getScrollEventTarget","currentNode","tagName","nodeType","overflowY","parentNode","getVisibleHeight","clientHeight","getElementTop","getBoundingClientRect","top","isAttached","doBind","context","binded","self","el","throttleDelayExpr","getAttribute","throttleDelay","undefined","Number","isNaN","scrollEventTarget","scrollListener","doCheck","addEventListener","disabledExpr","disabled","watchDisabledExpr","vm","$watch","value","immediateCheck","distanceExpr","distance","immediateCheckExpr","Boolean","force","viewportScrollTop","viewportBottom","shouldTrigger","scrollHeight","elementBottom","offsetHeight","expression","InfiniteScroll","created","bind","binding","vnode","instance","$nextTick","bindTryCount","tryBind","setTimeout","unmounted","unbind","removeEventListener","install","Vue","directive"],"sourceRoot":"","sources":["../../plugins/lib/infinite-scroll.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}